{% extends "base.html" %}
{% load static %}

{% block title %}
Página de Inicio
{% endblock %}

{% block content %}
<!-- Cabecera personalizada para el home -->
<header id="header" class="header">
    <form method="get" action="" class="search-filters-form">
        <!-- Primera fila: Logo y búsqueda -->
        <div class="row-top">
            <a href="/" class="logo">
                <img src="{% static 'images/logo.png' %}" alt="logo">
            </a>
            <input type="text" name="q" placeholder="Buscar por título..." value="{{ query }}" class="search-input">
        </div>

        <!-- Segunda fila: Filtros y botón -->
        <div class="row-bottom">
            <select name="ubicacion" class="custom-select">
                <option value="">Ubicación</option>
                <option value="Campamentos Saharauis" {% if ubicacion == "Campamentos Saharauis" %}selected{% endif %}>
                    Campamentos Saharauis
                </option>
                <option value="Tindouf" {% if ubicacion == "Tindouf" %}selected{% endif %}>Tindouf</option>
                <option value="Mauritania" {% if ubicacion == "Mauritania" %}selected{% endif %}>Mauritania</option>
                <option value="España" {% if ubicacion == "España" %}selected{% endif %}>España</option>
            </select>
            <select name="categoria" class="custom-select">
                <option value="">Categoría</option>
                {% for categoria in categorias %}
                <option value="{{ categoria.id }}" {% if categoria.id|stringformat:"s" == categoria_id %}selected{% endif %}>
                    {{ categoria.nombre }}
                </option>
                {% endfor %}
            </select>
            <select name="estado" class="custom-select">
                <option value="">Estado</option>
                <option value="Nuevo" {% if estado == "Nuevo" %}selected{% endif %}>Nuevo</option>
                <option value="Segunda mano" {% if estado == "Segunda mano" %}selected{% endif %}>Segunda mano</option>
            </select>
            <select name="orden" class="custom-select">
                <option value="">Ordenar</option>
                <option value="precio_asc" {% if orden == "precio_asc" %}selected{% endif %}>De más barato a más caro</option>
                <option value="precio_desc" {% if orden == "precio_desc" %}selected{% endif %}>De más caro a más barato</option>
                <option value="reciente" {% if orden == "reciente" %}selected{% endif %}>Recientes</option>
            </select>
            <button type="submit" class="apply-filters">Aplicar</button>
        </div>
    </form>
</header>

<!-- Contenido principal de productos -->
<div class="container">
    <h2>Productos Publicados</h2>
    <div class="productos">
        {% if productos %}
            {% for producto in productos %}
            <div class="producto" id="producto-{{ producto.id }}">
                <!-- Información del Usuario -->
                <div class="user-info">
                    <img src="{{ producto.usuario.perfil.avatar.url }}" alt="Avatar" width="50" style="border-radius: 50%;">
                    <p><strong>Vendedor:</strong> {{ producto.usuario.username }}</p>
                </div>
    
                <!-- Información del Producto -->
                <h3>{{ producto.titulo }}</h3>
                <p>{{ producto.descripcion }}</p>
                <p>Precio: {{ producto.precio }}</p>
                <p>Ubicación: {{ producto.ubicacion }}</p>
                <p>Categoría: {{ producto.categoria.nombre }}</p>
                <p>Estado: {{ producto.estado }}</p>
    
                <!-- Carrusel de imágenes -->
                <div id="carousel{{ producto.id }}" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        {% for imagen in producto.imagenes.all %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img src="{{ imagen.imagen.url }}" class="d-block w-100" alt="{{ producto.titulo }}">
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ producto.id }}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ producto.id }}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
    
                <!-- Ícono de Corazón -->
                <a href="javascript:void(0);" 
                    class="btn-favorito" 
                    data-producto-id="{{ producto.id }}" 
                    data-is-favorite="{% if producto.id in favoritos %}true{% else %}false{% endif %}">
                     <i class="far {% if producto.id in favoritos %}fas{% else %}far{% endif %} fa-heart" 
                    style="{% if producto.id in favoritos %}color: red;{% else %}color: gray;{% endif %}">
               </i>
                </a>




            </div>
            {% endfor %}
        {% else %}
            <p>No se encontraron productos.</p>
        {% endif %}
    </div>
    
</div>
{% endblock %}
