{% extends "base.html" %}
{% load static %}

{% block title %}Mi Perfil{% endblock %}

{% block content %}
<!-- Header con el logo -->
<header id="header" class="header">
    <div class="row-top">
        <a href="/" class="logo">
            <img src="{% static 'images/logo.png' %}" alt="logo">
        </a>
    </div>
</header>

<!-- Contenido del perfil -->
<h2>Mi Perfil</h2>

<div id="datos-perfil">
    <!-- Mostrar avatar del perfil -->
    {% if perfil.avatar and perfil.avatar.url %}
        <img src="{{ perfil.avatar.url }}" alt="Avatar" width="150" style="border-radius: 50%;">
    {% else %}
        <img src="{% static 'avatars/default_avatar.png' %}" alt="Avatar" width="150" style="border-radius: 50%;">
    {% endif %}
    <p><strong>Usuario:</strong> {{ perfil.user.username }}</p>
    <p><strong>Biografía:</strong> {{ perfil.bio|default:"Sin información" }}</p>
    <p><strong>Ubicación:</strong> {{ perfil.ubicacion|default:"Ubicación no especificada" }}</p>
</div>
<!-- Opción de Cerrar Sesión -->
<form method="post" action="{% url 'logout' %}" class="cerrar-sesion-form" style="margin-top: 20px;">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">Cerrar Sesión</button>
</form>

<!-- Botón para mostrar/ocultar datos y formulario -->
<button id="editar-perfil-btn" class="btn btn-secondary">Editar Perfil</button>

<!-- Formulario de Edición del Perfil -->
<div id="formulario-editar-perfil" style="display: none; margin-top: 20px;">
    <h3>Editar Perfil</h3>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">Guardar</button>
    </form>
</div>

<!-- Anuncios del Usuario -->
<h3>Mis Anuncios</h3>
<div id="anuncios">
    {% if anuncios %}
        <div class="productos">
            {% for anuncio in anuncios %}
            <div class="producto">
                <!-- Información del Producto -->
                <h4>{{ anuncio.titulo }}</h4>
                <p>{{ anuncio.descripcion }}</p>
                <p>Precio: {{ anuncio.precio }}</p>
                <p>Ubicación: {{ anuncio.ubicacion }}</p>
                <p>Categoría: {{ anuncio.categoria.nombre }}</p>
                <p>Estado: {{ anuncio.estado }}</p>

                <!-- Carrusel de imágenes -->
                <div id="carousel{{ anuncio.id }}" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        {% for imagen in anuncio.imagenes.all %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img src="{{ imagen.imagen.url }}" class="d-block w-100" alt="{{ anuncio.titulo }}">
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ anuncio.id }}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ anuncio.id }}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>

                <a href="{% url 'editar_anuncio' anuncio.id %}" class="btn btn-secondary">Editar</a>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No has publicado ningún anuncio todavía.</p>
    {% endif %}
</div>


{% endblock %}
